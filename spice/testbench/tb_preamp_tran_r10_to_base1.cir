* Preamp Transient — R10 connects DIRECTLY to base1 (after Cin)
* ================================================================
* Test: Does connecting R10 after the coupling cap (to base1)
* eliminate latch-up while maintaining correct AC behavior?
*
* If R10 connects to base1, the feedback loop is:
*   output -> R10 -> base1 -> Q1(invert) -> Q2(invert) -> output
* Two inversions = non-inverting path. R10 connects to the NON-inverting
* input of this two-stage amp. This is SHUNT-SHUNT NEGATIVE feedback
* because R10 injects CURRENT at the base (current summing), and the
* feedback signal is proportional to the output VOLTAGE.
*
* Crucially: R10 to base1 means the R2/R3 bias network at base1
* gets DC current injected through R10. This creates a DC feedback loop:
* output rises -> more current through R10 -> raises base1 -> Q1 conducts
* more -> coll1 drops -> Q2 conducts less -> output rises (POSITIVE!)
*
* Wait — let's check: if base1 goes up -> Q1 Ic increases -> coll1 goes
* DOWN (Vcc - Ic*Rc) -> Q2 Ib decreases -> Q2 Ic decreases -> coll2 goes
* UP -> output goes UP -> R10 pushes base1 UP even more... POSITIVE FEEDBACK!
*
* So R10 to base1 is ALSO positive DC feedback through the non-inverting
* two-stage path. The question is: does the existing bias network (R2/R3)
* provide enough DC attenuation/absorption to keep the loop gain < 1?

.title Preamp Tran - R10 to base1 test

.include ../models/transistors.lib
.include ../models/diodes.lib

* ============================================
* MODIFIED PREAMP — R10 goes to base1 directly
* ============================================
.SUBCKT wurli_preamp_mod in out vcc gnd trem

* Input coupling cap from 'in' to base1
Cin   in    base1  0.022U

* Base1 bias network
R2    vcc   base1  2MEG
R3    base1 gnd    470K
C20   base1 gnd    220P
D1    gnd   base1  D1N4148

* Stage 1
Q1    coll1 base1 emit1  Q2N5089
Rc1   vcc   coll1  150K
Re1   emit1 gnd    33K
Ce1   emit1 gnd    4.7U
Cc3   coll1 base1  100P

* Stage 2
Q2    coll2 coll1 emit2a  Q2N5089
Rc2   vcc   coll2  1.8K
Re2a  emit2a emit2b  270
Ce2   emit2a emit2b  22U
Re2b  emit2b gnd    820
Cc4   coll2  coll1  100P

* Output
R9    coll2 out    6.8K

* MODIFIED: R10 connects from output to base1 (AFTER the coupling cap)
R10   out   base1  56K

* Trem pin connects to 'in' for LDR
Rtrem in    trem   0.001

.ENDS wurli_preamp_mod

* ============================================
* Testbench
* ============================================

Vcc  vcc 0  DC 15
Xpre  in_sig out vcc 0 trem  wurli_preamp_mod

R1   0 in_sig  22K
Rldr trem 0  12K
Rload out 0  100K

.tran 10U 500M 0 10U

.print TRAN V(in_sig) V(Xpre.base1) V(Xpre.coll1) V(Xpre.coll2) V(out)

.end
