* Wurlitzer 200A Reed-Bar Preamp Subcircuit
* ===========================================
* Two-stage direct-coupled NPN CE amplifier (TR-1, TR-2 = 2N5089)
* with series-series emitter feedback through R-10/Ce1 and
* Miller feedback caps C-3, C-4.
*
* Topology resolved from BustedGear 200A schematic (874 KB PDF)
* at 1000-2000 DPI plus DC analysis and SPICE stability validation.
* All component values VERIFIED. See docs/preamp-circuit.md.
*
* TOPOLOGY NOTES:
*   R-2 (2M to +15V) and R-3 (470K to GND) are both at base1,
*   providing the DC bias: Vth=2.85V -> Vb=2.45V with base current loading.
*   C20 (220pF) also at base1 forms LPF with R-2||R-3=380K at ~1903 Hz.
*
*   FEEDBACK (CORRECTED Feb 2026):
*   R-10 (56K) feeds from preamp output to fb_junct.
*   Ce1 (4.7 MFD) AC-couples fb_junct to TR-1's emitter.
*   This is SERIES-SERIES NEGATIVE FEEDBACK (emitter feedback).
*   Re1 (33K) provides the separate DC path from emitter to ground.
*
*   LG-1 (LDR) shunts fb_junct to ground via cable Pin 1 ->
*   50K VIBRATO pot -> 18K -> LG-1 -> GND.
*   When LDR is LOW (bright): fb_junct shunted to ground ->
*     feedback can't reach emitter -> HIGHER gain (~12 dB / 4.0x)
*   When LDR is HIGH (dark): full feedback reaches emitter ->
*     strong emitter degeneration -> LOWER gain (~6 dB / 2.0x)
*
*   IMPORTANT: An earlier version had R-10 feeding to node_A
*   (before .022uF coupling cap), forming shunt-feedback. That
*   topology is WRONG -- the two non-inverting CE stages create
*   POSITIVE feedback to node_A, causing oscillation. Emitter
*   feedback is inherently negative and SPICE-validated stable.
*   See preamp-circuit.md Section 7.3 for correction history.
*
* Pins:
*   in      - signal input (from pickup through R-1)
*   out     - signal output (after R-9, 6.8K series)
*   vcc     - +15V supply
*   gnd     - ground reference
*   fb_junct - feedback junction (connect LDR path here)
*              For no tremolo: connect 1MEG to gnd
*              For tremolo: connect LDR path to gnd
*
* DC operating points (targets):
*   TR-1: B=2.45V, E=1.95V, C=4.1V, Ic~73uA
*   TR-2: B=4.1V, E=3.4V, C=8.8V, Ic~3.4mA
*
* Closed-loop gain (SPICE-measured, corrected topology):
*   No tremolo (Rldr_path=1M): 6.0 dB (2.0x)
*   Tremolo bright (Rldr_path=19K): 12.1 dB (4.0x)
*   Tremolo boost: 6.1 dB (matches EP-Forum measurement)

.SUBCKT wurli_preamp in out vcc gnd fb_junct

* --- Input coupling capacitor ---
* .022 uF blocks DC (pickup is at ~150V through R_feed + R-1)
* but passes audio signals to base1
Cin   in    base1  0.022U

* --- Base1 bias network ---
* R-2 (2M) from Vcc to base1 -- DC pull-up
* R-3 (470K) from base1 to ground -- DC pull-down
* Thevenin: Vth = 15 * 470K / (2M + 470K) = 2.854V
* C20 (220pF) shunt to ground -- LPF with R-2||R-3 = 380K, f_c ~1903 Hz
* D-1 (1N4148 stand-in) reverse-biased protection diode
R2    vcc   base1  2MEG
R3    base1 gnd    470K
C20   base1 gnd    220P
D1    gnd   base1  D1N4148

* --- Stage 1: TR-1 (2N5089 NPN common-emitter) ---
* Rc1 = 150K collector load
* Re1 = 33K DC emitter path to ground
* Ce1 = 4.7uF couples emitter to feedback junction (NOT to ground!)
* C-3 = 100pF collector-base Miller feedback cap
Q1    coll1 base1 emit1  Q2N5089
Rc1   vcc   coll1  150K
Re1   emit1 gnd    33K
Ce1   emit1 fb_junct 4.7U
Cc3   coll1 base1  100P

* --- Direct coupling: TR-1 collector = TR-2 base ---
* (coll1 node serves as both TR-1 collector and TR-2 base)

* --- Stage 2: TR-2 (2N5089 NPN common-emitter) ---
* Rc2 = 1.8K collector load
* Re2a = 270 ohm (bypassed by Ce2 = 22uF) + Re2b = 820 ohm (unbypassed)
* C-4 = 100pF collector-base Miller feedback cap
Q2    coll2 coll1 emit2a  Q2N5089
Rc2   vcc   coll2  1.8K
Re2a  emit2a emit2b  270
Ce2   emit2a emit2b  22U
Re2b  emit2b gnd    820
Cc4   coll2  coll1  100P

* --- Output series resistor ---
R9    coll2 out    6.8K

* --- Global AC negative feedback (series-series / emitter) ---
* R-10 (56K) from output to feedback junction (fb_junct).
* Ce1 (4.7 MFD) AC-couples fb_junct to TR-1 emitter.
* LDR path (external) shunts fb_junct to ground, modulating
* how much feedback reaches the emitter and thus the gain.
R10   out   fb_junct  56K

.ENDS wurli_preamp
